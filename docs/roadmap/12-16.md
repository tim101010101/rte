# 2022-12-16

关于从指针位置获取 VNode 的需求, 暂时也许可以先从 fence 下手, 在 fence 中添加一个数组, 存储光标偏移量对应的 VNode

先整理一下目录结构, 把 block 和 page 单独抽出去

## 补档

发现自己是傻逼, 都做了 VNode 为什么还要总是基于 DOM 来操作....

回退一版重构一下

## 补档

重构到基于 VNode 是简单的, 但是 fence 数组的事情不好处理, 要真正处理好 fence 数组, 需要明确 marker 的展现形式以及存储方式, 比如

```markdown
|**hello world**
**|hello world**
**hello world|**
**hello world**|
```

以上四种情况, 光标在不在 VNode 中?

需要从长计议

## 补档

重构了 fence, 其中保存行高以及位偏移量, 还有一个 fenceList

重构完成之后, 已经可以正常的移动光标了, 代码也简洁了不少, 不过暂时没有考虑优化, 这些之后再说

接下来实现光标移入语法结构时显示 marker 的功能

最简单的实现思路是在主内容的 VNode 中保存 marker 的 VNode, 先这样实现出来, 再来考虑优化

## 补档

上面说的错了, 在 VNode 中保存 marker 的思路实际上实现起来还是很麻烦, 因为这里使用副作用改变 VNode 非常麻烦

考虑到后续维护, 也许是需要引入 VVNode

先存个档先
