# 2023-1-4

点击移动光标的部分重构好了, 用了两个二分, 分别查找命中 block 以及最接近的 offset, 但是在测试过程中发现有小 bug, 不是很严重, 暂时不打算修复

但是需要单独开个文件记录下来

## 一个想法

将目前 selection 的一些功能移动到 Focusable 接口中, cursor 只作为调用者, 以此来同时支持 line 以及行为各异的 block

包括

- focusOn/unFocus
- left/right/up/down
- active/cancelActive
- newLine
- select (是否需要?)

## 补档

eventBus 的具体实现需要考虑 selection 的架构, 因此还是先来重构, Block -> Focusable

## 补档

重构完成, 目前的架构比之前灵活很多, 所有操作依然是基于 selection, 但是 selection 的行为并没有耦合在 selection 的实现中, 而是根据 pos 所指向的 Operable 节点而定

也就是说, 控制逻辑在 selection 中, 而具体的行为逻辑在 Operable 的具体实现中, 后续就可以根据现有的 OperableNode 基类拓展出不同的莫名其妙的结构

比如一个发散性的思维导图结构, 该结构不需要 active, 被 focus 之后, 光标的移动逻辑会发生改变, 比如按照按键方向移动到最接近的下一个节点之类的

总之还是蛮有意思的

后续可以拓展一下 schema, 提供给 schame 重写 Operable 节点的能力, 这样的话可配置性就进一步增强了

接下来先稳一手, 提交之后合入 main, 然后改一下 bug 加一下注释
