# 2023-6-22

经过 demo, 离屏渲染的思路完全可行，但是存在很多细节需要进一步处理，比如像素比例的问题，不解决的话会导致图像越来越模糊

主要思路就是创建一个 offscreenCanvas 作为缓冲区

滚动事件触发时

- 图形层内容 `drawImage` 到缓冲区
- 清空图形层
- 缓冲区内容 `drawImage` 到图形层
- 清空缓冲区

关于一些细节的处理，还需要进一步研究，目前知道的问题

- 像素比例
- 渲染帧数保证

## 关于渲染器

最理想的 api 设计应该是这样

```typescript
function renderXxx(
  { width, height, x, y }: Rect,
  fn: (ctx, node) => void,
  config: Config
) {
  render({
    width,
    height,
    x,
    y,
    render: fn,
    ...config,
  });
}
```

用一个 rect 来约束当前这个元素的渲染区域, 然后调用传入的绘制方法，以相对渲染区域的方式进行绘制

那么这里就有一个问题，如果绘制范围超过了渲染范围，隐藏还是继续绘制呢, 再者说，要如何得知当前的绘制范围是否超出了渲染范围

这个应该好处理，绘制过程实际上是逐个 textNode 进行绘制，那么就可以计算高度和宽度了，超出就不进行绘制，或者绘制完做一个 clip

明天解决像素比例的问题
