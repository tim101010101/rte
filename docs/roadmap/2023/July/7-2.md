# 2023-7-2

今天深入研究一下 react 的渲染策略

不对，发现一个大问题，渲染的优化思路并不是目前的重点工作，最重要的是对于渲染本身的实现.....nm

所以可以先把渲染的重构完成，再来引入渲染的优化, 到时也方便做个 benchmark

## 关于目前的渲染问题

最理想的架构依然是数据完全由 model 层控制, 包括位置信息，而渲染层只负责根据数据进行渲染，那么数据就分为两种

- 节点数据
  - 样式数据
  - 文本数据
- 位置数据

那么假设存在一个渲染层 API `Render::draw(node: ListView, rect: Rect) -> Rect`

目前的 model 层能够正确的处理么, 先针对 model 层做排查，定位一下目前的渲染 bug

应该有两种可能

1. calcFence 的时候对 rect 的计算出现了问题
2. render 渲染时，对 rect 的处理存在问题

刚刚 debug 了一下，发现代理中拿到 rect 时就已经是错误的 rect 了

那么是不是说明是 render 那边计算时存在问题呢，等等吃饱再来仔细看看

有头绪了，目前换行时存在两个问题

1. 插入换行时，被往下挤的那一行 block 的位置信息没有更新
2. 位置信息的更新没有同步到 context 的链表当中

暂时没时间处理，需要先调研一下 SSR 为过段时间的工作做准备
