# 2022-12-12

思考了很久, 认为目前的架构不够清晰, 存在问题

## 一个 idea

扁平化所有的 VNode

```typescript
{
  tagName: 'span',
  props: {},
  children: [
    {
      tagName: 'span',
      text: 'hello',
      type: 'strong'
    },
    {
      tagName: 'span',
      text: 'world',
      type: ['strong', 'em']
    },
  ]
}
```

好处

1. 计算 range 非常方便
2. 修改样式非常方便
3. 合并/拆分节点非常方便

坏处

1. 如
   this is a text **hello _world_**

   光标移动到 h 之前, 应该是这样

   this is a text \*\*|hello _world_\*\*

   光标移动到 w 之前, 应该是这样

   this is a text \*\*hello \_|world\_\*\*

   如果扁平化节点的话, 这里很难处理

1. 渲染逻辑要大改, 要对相邻的同类型节点进行合并

## 补档

要大型重构了...

push 一下存个档
